<img width="735" height="619" alt="image" src="https://github.com/user-attachments/assets/abef38d6-c56d-4f01-a3c1-8c6a9c8f5959" />

- Atmega328 : usb í†µì‹  ë¶ˆê°€ëŠ¥ / MCU ì¼ì¢… / ë©”ì¸ ì¹© ì—­í• 
  - MCUëŠ” ì‘ì•„ë³´ì´ì§€ë§Œ ì›¬ë§Œí•œê±° ë‹¤ ë“¤ì–´ê°€ ìˆìŒ(ë©”ëª¨ë¦¬, SRAM ë“±) / ICSP (VCC, MOSI, MISO ë“±) í†µí•´ í”Œë ˆì‹œ ë©”ëª¨ë¦¬ì— ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ êµ¬ìš¸ ìˆ˜ ìˆìŒ
- GPIO : ë¹µíŒê³¼ ì—°ê²° / I2C í†µì‹ ì„ ìœ„í•œ SCL, SDA í¬íŠ¸ ë”°ë¡œ ìˆëŠ” ê²ƒ ì£¼ì˜
- ì‹¤ì œ í”„ë¡œê·¸ë¨ ë‹¤ìš´ë¡œë“œëŠ” USBë¥¼ í†µí•´ Atmega16 -> TX/RX í†µì‹  -> Atmega328 ì´ë ‡ê²Œ ë“¤ì–´ì˜´
- Atmega16 : USB Serial Portë¡œ ì¸ì‹, TX, Rxì™€ ë§ë¬¼ë ¤ìˆìŒ
- TX : ì „ì†¡ / RX : ë°›ëŠ” ê²ƒ :

<img width="164" height="166" alt="image" src="https://github.com/user-attachments/assets/7082e30b-9514-4225-ba69-bec0301c0f0d" />

- ë””ë²„ê±° íˆ´ ì—°ê²°í•˜ëŠ” ìœ„ì¹˜
- ì•„ë‘ì´ë…¸ : ì´íƒˆë¦¬ì•„ì–´ ? ê°•ë ¥í•œ ì¹œêµ¬ë¼ëŠ” ëœ»

<img width="1606" height="888" alt="image" src="https://github.com/user-attachments/assets/3c88b283-23f4-4dd0-8988-14bfa9a9a4a4" />

### ì•„ë‘ì´ë…¸ ì˜ˆì œ

1) ì•„ë‘ì´ë…¸ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
- https://www.arduino.cc/en/software/ ìœ„ì¹˜ì—ì„œ ë‹¤ìš´ë¡œë“œ

2) VSCode
- ì£¼ì˜ : ê¸°ì¡´ wsl í™˜ê²½ ëŒ€ì‹  ìœˆë„ìš°ì—ì„œ ì‘ì—…í•˜ë¯€ë¡œ, wsl í™˜ê²½ì—ì„œ ë‚˜ì™€ì„œ extentionì„ ê¹”ì•„ì£¼ì–´ì•¼ í•¨.
- ì•„ë‘ì´ë…¸ëŠ” GCC ëŒ€ì‹  ë‹¤ë¥¸ ì»´íŒŒì¼ëŸ¬ë¥¼ ì¨ì•¼ í•œë‹¤.

<img width="751" height="534" alt="image" src="https://github.com/user-attachments/assets/e2eabde8-0ba8-40ff-8848-7cceff9acd0e" />

- extentionì—ì„œ PlatformIO IDE ì„¤ì¹˜

<img width="893" height="753" alt="image" src="https://github.com/user-attachments/assets/366a68ed-27f0-48a9-99cb-427cc747e102" />

- delay -> blocking í•¨ìˆ˜ë¼ê³  í•¨


- VSCODE ì—ì„œì˜ ì‹¤ìŠµ) blink ì˜ˆì œ

- 1. flatformio extentionì„ ì„¤ì¹˜ í›„ new project ìƒì„±
  2. Arduino uno ì„ íƒ, project name : blink
  3. ì‘ì—… ë””ë ‰í† ë¦¬

```c
#include <Arduino.h>
/*
  Blink

  Turns an LED on for one second, then off for one second, repeatedly.

  Most Arduinos have an on-board LED you can control. On the UNO, MEGA and ZERO
  it is attached to digital pin 13, on MKR1000 on pin 6. LED_BUILTIN is set to
  the correct LED pin independent of which board is used.
  If you want to know what pin the on-board LED is connected to on your Arduino
  model, check the Technical Specs of your board at:
  https://docs.arduino.cc/hardware/

  modified 8 May 2014
  by Scott Fitzgerald
  modified 2 Sep 2016
  by Arturo Guadalupi
  modified 8 Sep 2016
  by Colby Newman

  This example code is in the public domain.

  https://docs.arduino.cc/built-in-examples/basics/Blink/
*/

// the setup function runs once when you press reset or power the board
void setup() {
  // initialize digital pin LED_BUILTIN as an output.
  pinMode(LED_BUILTIN, OUTPUT);
}

// the loop function runs over and over again forever
void loop() {
  digitalWrite(LED_BUILTIN, HIGH);  // turn the LED on (HIGH is the voltage level)
  delay(1000);                      // wait for a second
  digitalWrite(LED_BUILTIN, LOW);   // turn the LED off by making the voltage LOW
  delay(1000);                      // wait for a second
}

```

- #include <Arduino.h> <- ê¸°ì¡´ ì•„ë‘ì´ë…¸ í”„ë¡œê·¸ë¨ê³¼ì˜ ì°¨ì´ì . VSCodeì—ì„œ ì‚¬ìš©ì‹œì—ëŠ” `Arduino.h` í—¤ë” íŒŒì¼ì„ í™•ì¸í•´ì•¼í•œë‹¤.
- íŒì›¨ì–´ëŠ” ê° ë””ë°”ì´ìŠ¤, íšŒì‚¬ë§ˆë‹¤ íŠ¹ì„±ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— êµìœ¡í•˜ê¸° ê¹Œë‹¤ë¡­ë‹¤.

- ì•„ë‘ì´ë…¸ì—ì„œëŠ” ì£¼ì†Œê°€ 8ë¹„íŠ¸ -> addressê°€ ì–¼ë§ˆ ì—†ë‹¤.
- ì‹¤ì œ RC ì¹©ì—ì„œëŠ”  13ë²ˆì— í•´ë‹¹í•˜ëŠ”ê±° í•˜ë‚˜ë§Œ ì œì–´ë¥¼ í•´ì£¼ê² ë‹¤.
    - `*(volatile unsigned char*)0x24 |= 0x20;`
-  ë³€ìˆ˜ í•˜ë‚˜ ì„ ì–¸í•˜ê³  ì»´íŒŒì¼í–ˆì„ ì‹œ, ì˜µí‹°ë§ˆì´ì € ë ˆë²¨ì„ ë†’ì´ë©´ ì„ ì–¸ë§Œ í•˜ê³  í•„ìš”ì—†ë„¤? -> ì»´íŒŒì¼ ì•ˆí•¨
-  íŒì›¨ì–´ì—ì„œëŠ” ì„ ì–¸ë§Œ í•˜ê³  ì“°ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì„¤ì •í•˜ê±°ë‚˜ ë¦¬ì…‹í•˜ëŠ” ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì—.
-  ë”°ë¼ì„œ `volatile` ì„ ê¼­ ë„£ì–´ì¤˜ì•¼ íœ˜ë°œì„±ì´ ì‚¬ë¼ì§„ë‹¤(?)
-  0x24ëŠ” í¬íŠ¸(ë¬¼ë¦¬ì ì¸ í•˜ë“œì›¨ì–´), ë©”ëª¨ë¦¬ë¼ê³  ìƒê°. 8ê°œì˜ ì£¼ì†Œë¥¼ inputìœ¼ë¡œ í• ì§€ , outputìœ¼ë¡œ í• ì§€ ì •í•˜ëŠ”ê²ƒ
-  ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œ ì½”ë“œê°€ í™•ì •ì´ ë˜ì–´ë²„ë¦°ë‹¤.
-  ì»´íŒŒì¼í•˜ë©´ ì‹¤ì œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜´

```c
  *(volatile unsigned char*)0x25 |= 0x20;
  delay(100);
  *(volatile unsigned char*)0x25 &= ~0x20; //-> ì˜ë¯¸?
  delay(100);
```

- gcc 7.3.0

- ì•„ë‘ì´ë…¸ ìš°ë…¸ PlatformIOì—ì„œ ì–´ì…ˆë¸”ë¦¬(Assembly) íŒŒì¼ ì–»ëŠ” ë°©ë²•
    
    PlatformIOì—ì„œ C/C++ í”„ë¡œì íŠ¸ì˜ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ í™•ì¸í•˜ë ¤ë©´, ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ### 1. `platformio.ini` ì„¤ì •
    
    `platformio.ini` íŒŒì¼ì—ì„œ `build_flags` ì˜µì…˜ì„ í™œìš©í•´ ì»´íŒŒì¼ëŸ¬ê°€ ì–´ì…ˆë¸”ë¦¬ íŒŒì¼ì„ ìƒì„±í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ```
    [env:uno]
    platform = atmelavr
    board = uno
    framework = arduino
    build_flags =
        -save-temps=obj
        -fverbose-asm  // ì´ìª½ìœ¼ë¡œ ì¶œë ¥ì„ ë‚´ë³´ë‚´ì¤Œ
    ```

  // ìˆ˜ì • í›„ ë‹¤ì‹œ ë¹Œë“œ
    
    - `save-temps=obj` : ë¹Œë“œ ë””ë ‰í† ë¦¬ì— ì¤‘ê°„ ì‚°ì¶œë¬¼ íŒŒì¼(`.s`, `.i`, `.ii` ë“±)ì„ ìƒì„±í•©ë‹ˆë‹¤.
    - `fverbose-asm` : ì–´ì…ˆë¸”ë¦¬ íŒŒì¼ ë‚´ì— ì¶”ê°€ ì •ë³´ë¥¼ í¬í•¨í•˜ë„ë¡ í•©ë‹ˆë‹¤[1][2].
    
    ### 2. ë¹Œë“œ í›„ ì–´ì…ˆë¸”ë¦¬ íŒŒì¼ ìœ„ì¹˜
    
    ì»´íŒŒì¼ í›„ `.pio/build/[í™˜ê²½ëª…]/` í´ë”ë¡œ ì´ë™í•˜ë©´, `.s` íŒŒì¼ì´ ìƒì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    
    - ì˜ˆì‹œ ê²½ë¡œ: `.pio/build/uno/src/main.cpp.s`
    
    ### 3. ì „ì²´ í”„ë¡œì íŠ¸ ì–´ì…ˆë¸”ë¦¬ ì¶”ì¶œ (objdump í™œìš©)
    
    ì»´íŒŒì¼ì´ ëë‚œ í›„, `.elf` íŒŒì¼ì„ `objdump`ë¡œ ë””ìŠ¤ì–´ì…ˆë¸” í•˜ë©´ ì „ì²´ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ í•œ íŒŒì¼ë¡œ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ```c
    C:\Users\hanki\.platformio\packages\toolchain-atmelavr\bin\avr-objdump.exe   
    ```
    
    ```bash
    cd .pio/build/uno
    avr-objdump -S -d firmware.elf > firmware.s
    
    C:\Users\hanki\.platformio\packages\toolchain-atmelavr\bin\avr-objdump  -S -d firmware.elf > firmware.s
    ```
    
    - `firmware.s`ì— ì–´ì…ˆë¸”ë¦¬ ì½”ë“œì™€ C ì†ŒìŠ¤ê°€ ë³‘ê¸°ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤[2][1][3].
    
    ### 4. ì¶”ê°€ íŒ: post_build ìŠ¤í¬ë¦½íŠ¸ í™œìš©
    
    ë¹Œë“œ í›„ ìë™ìœ¼ë¡œ ì–´ì…ˆë¸”ë¦¬ listing íŒŒì¼ì„ ìƒì„±í•˜ê³  ì‹¶ì„ ê²½ìš°, `post_build.py` ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    - `platformio.ini`ì— ë‹¤ìŒ ì¶”ê°€:
        
        ```
        extra_scripts = post_build.py
        
        ```
        
    - ë£¨íŠ¸ í´ë”ì— `post_build.py` íŒŒì¼ ì‘ì„±:
        
        ```python
        Import("env")
        def after_build(source, target, env):
            objdump = env.subst("${OBJCOPY}").replace("objcopy", "objdump")
            src_elf = env.subst("${BUILD_DIR}/${PROGNAME}.elf")
            env.Execute(f"{objdump} -S -C -d {src_elf} > ${PROGNAME}.lst")
        env.AddPostAction("${BUILD_DIR}/${PROGNAME}.elf", after_build)
        
        ```
        
    - ë¹Œë“œí•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¦¬ìŠ¤íŒ… íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

- drawioì„¤ì¹˜ ë˜ëŠ” figma
    - https://app.diagrams.net/
 
- ë ˆì§€ìŠ¤í„°ì˜ íŠ¹ì • ë¹„íŠ¸ë¥¼ ì œì–´í•˜ëŠ” ê²ƒì€ ì£¼ë¡œ ë¹„íŠ¸ ì—°ì‚° ì‚¬ìš©
- í•˜ë“œì›¨ì–´ì œì–´ì— í•„ìš”í•œ ê¸°ë³¸ ë£°

# íŠ¹ì • ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì • â‡’ ì§€ì •ëœ ìœ„ì¹˜ì˜ ë¹„íŠ¸ë¥¼ 1ê³¼ |(OR)ì—°ì‚°

- 5ë²ˆ ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì •
    
    ```c
        01010101
    OR  00**1**00000
    ---------------
        01**1**10101  
    
    ```
    

- ìœ„ì˜ ì—°ì‚°ì„ ì½”ë“œí™” í•œë‹¤ë©´
    
    ```c
    a |= 0b00**1**00000;
    ```
    

- ê·¸ëŸ°ë° 0b0010_0000ì€ 0x1(0b0000_0001)ì„ 5ë²ˆ ì™¼ìª½ ì‰¬í”„íŠ¸í•œ ê°’ê³¼ ê°™ë‹¤.
    
    ```c
    a |= 0x1 <<5;
    ```
    

- í•œë²ˆì— ì—¬ëŸ¬ë¹„íŠ¸ ì„¤ì •ë„ ê°€ëŠ¥
    
    ```c
    a |= (0x1<<5) + (0x1<<3) + (0x1<<2);
    ```
    

- ê·¸ëŸ°ë° 3,2ë²ˆ ë¹„íŠ¸ì€ ì—°ì†ëœ ë¹„íŠ¸ì´ê¸°ì— 0x3ìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤.
    
    ```c
                            a |= (0x1<<5) + (0x3<<2);
    ```
    

# íŠ¹ì • ë¹„íŠ¸ í´ë¦¬ì–´

- í´ë¦¬ì–´ëŠ” ì§€ì •ëœ ë¹„íŠ¸ë¥¼ 0ê³¼ &ì—°ì‚°í•œë‹¤.0
- íŠ¹ì • ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì •í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ 0ì„ ì›í•˜ëŠ” ìœ„ì¹˜ê¹Œì§€ ì‰¬í”„íŠ¸í•˜ê³  & ì—°ì‚°í•œë‹¤.

> 0x0ìœ¼ë¡œ ìë¦¬ìˆ˜ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤. â‡’ 1ì„ ì›í•˜ëŠ” ìœ„ì¹˜ë¡œ ì‰¬í”„íŠ¸í•˜ê³  ~(NOT)ì—°ì‚°ì„ í•´ì„œ 0ìœ¼ë¡œ ë§Œë“ ë‹¤.
> 
> 
> ```c
>   0x1<<5    0b0010_0000
> ~(0x1<<5)   0b1101_1111
> ```
> 
- 2ë²ˆ ë¹„íŠ¸ë¥¼ 0ìœ¼ë¡œ í´ë¦¬ì–´í•˜ë ¤ë©´ ì†ŒìŠ¤ë°ì´í„°ì— 0b11111011ì„ &ì—°ì‚°
    
    ```c
    a &=~(0x1<<2);
     ~0000_0100
      1111_1011
    & 1111_1111
    ------------
      1111_1011
    ```
    
- ì—¬ëŸ¬ë¹„íŠ¸ í´ë¦¬ì–´ : 5,3,2ë²ˆ ë¹„íŠ¸ í´ë¦¬ì–´í•˜ë ¤ë©´
    
    ```c
    	a &=~((0x1<<5)+(0x3<<2));
    ```
    

# íŠ¹ì • ë¹„íŠ¸ ë°˜ì „

- ë°˜ì „ ì‹œí‚¤ê³ ì í•˜ëŠ” ë¹„íŠ¸ëŠ” 1ê³¼ ^ì—°ì‚° â‡’ ë‘ í”¼ì—°ì‚°ìê°€ ê°™ìœ¼ë©´ 0, ë‹¤ë¥´ë©´ 1ë¡œ ì„¤ì •ë¨
    
    ```c
    1^1 = 0
    0^1 = 1
    --------
    ~~1^0 = 1
    0^0 = 0~~
    ```
    

- 5ë²ˆ ë¹„íŠ¸ë¥¼ ë°˜ì „ í•˜ë ¤ë©´
    
    ```c
    a ^= 0x01<<5;
    ```
    
- 5,3,2ë¥¼ ë°˜ì „í•˜ë ¤ë©°
    
    ```c
    a ^= (0x01<<5) + (0x3<<2);
    ```
    

# ë¹„íŠ¸ ê²€ì‚¬

- íŠ¹ì • ë¹„íŠ¸ê°€ 0ì¸ì§€ 1ì¸ì§€ ê²€ì‚¬
- 5ë²ˆì§¸ ë¹„íŠ¸ê°€ 0/1ì¸ì§€ ê²€ì‚¬
    
    ```c
    a & (0x1<<5)
    
    **1**01010 & **1**00000 => 100000
    ```
    

# ë¹„íŠ¸ ì¶”ì¶œ

- íŠ¸ì • ë¹„íŠ¸ë§Œ ì¶”ì¶œ [6:4]ë¹„íŠ¸ë§Œ ì¶”ì¶œí•˜ê³  ì‹¶ë‹¤.
    
    ```c
    a & 0x70
    
    a=0b10101010 & 0b0111_0000
    ```
    

# ë¹„íŠ¸ ì—°ì‚°ì„ í¸í•˜ê²Œ

- í•¨ìˆ˜ë¡œë„ ê°€ëŠ¥í•˜ì§€ë§Œ â‡’ ì‘ì€ ë¶€ë¶„ì€ ì„±ëŠ¥ì„ ë–¨ì–´ëœ¨ë¦¼ â‡’ ë§¤í¬ë¡œ í•¨ìˆ˜ ì‚¬ìš©
    
    ```c
    unsigned char a = 0xf0; //1111_0000
    
    a &= ~(0x1<<5); //í•œ ë¹„íŠ¸ í´ë¦¬ì–´ (5ë²ˆë¹„íŠ¸)
    a &= ~(0x7<<3); //ì—°ì†ëœ ì—¬ëŸ¬ë¹„íŠ¸ í´ë¦¬ì–´ (5,4,3ë²ˆ ë¹„íŠ¸)
    a &= ~((0x1<<5)+(0x3<<2)); //ë–¨ì–´ì ¸ ìˆëŠ” ì—¬ëŸ¬ë¹„íŠ¸ í´ë¦¬ì–´ (5,3,2ë²ˆ ë¹„íŠ¸)
    ```
    

ìœ„ ë¹„íŠ¸ ì—°ì‚°ì„ ë§¤í¬ë¡œë¡œ ë§Œë“¤ë©´ â‡’ macro.h

```c
**//í•œ ë¹„íŠ¸ í´ë¦¬ì–´**
#define clear_bit(data,loc)  ((data) &= **~**(0x1<<(loc)))
//ì—°ì†ëœ ì—¬ëŸ¬ë¹„íŠ¸ í´ë¦¬ì–´
#define clear_bits(data,area,loc)  ((data) &= **~**((area)<<loc)))

**//í•œ ë¹„íŠ¸ ì„¤ì •**
#define set_bit(data,loc)  ((data) |= (0x1<<(loc)))
//ì—°ì†ëœ ì—¬ëŸ¬ë¹„íŠ¸ ì„¤ì •
#define set_bits(data,area,loc)  ((data) |= ((area)<<loc)))

//ë¹„íŠ¸ ê²€ì‚¬
#define check_bit(data,loc)   ((data) & (0x1<<loc)))

//ë¹„íŠ¸ ì¶”ì¶œ
#define extract_bits(data,area,loc) (((data)>>(loc) & (area))

```

# ë§¤í¬ë¡œ ì‚¬ìš©ì‹œ ì¹˜í™˜ì— ì£¼ì˜ í•˜ì!

```c
#include <stdio.h>
#define ADD(x) x+x

void main(void){
	int k;
	k=-ADD(5);

}
```

- ìœ„ì˜ ì†ŒìŠ¤ëŠ” ë‘ìˆ˜ì˜ í•©ì„ ìŒìˆ˜í™” í•˜ë ¤ê³  í•œë‹¤. â‡’ -10

```c
k=-5+5  // k=0ì´ ëœë‹¤.
```

ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ì›í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤.

```c
#define ADD(x) (x+x)
```

```c
int k= -ADD(3)  //-> -6ì–»ê³  ì‹¶ì—ˆëŠ”ë°,

int k=-(3+3) //-6
```

<aside>
ğŸ’¡

í•œê°€ì§€ ë”!

</aside>

```c
#include <stdio.h>
#define SQUARE(x) (x*x)

void main(void){
	int a = 2;
	printf( "%d", SQUARE(a+5));

}
```

ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤.

```c
(a+5*a+5) = (2+**5*2**+5=17)
```

ì›í•˜ëŠ” ê²°ê³¼ëŠ” 7*7=49ì´ë‹¤. ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì•¼ í•œë‹¤. 

```c
#define SQUARE(x) ((x)*(x))
```

ì •ë¦¬í•˜ë©´ ê° ì¸ìë¥¼ ê´„í˜¸ë¡œ ë¬¶ì–´ì£¼ê³ , ì „ì²´ ìˆ˜ì‹ ë˜í•œ ê´„í˜¸ë¡œ ë¬¶ì–´ì£¼ì–´ì•¼ í•œë‹¤.!
